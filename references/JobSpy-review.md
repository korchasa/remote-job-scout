# Обзор JobSpy - библиотеки для скрапинга вакансий

## Общая архитектура

JobSpy - это Python библиотека для конкурентного скрапинга вакансий с популярных
сайтов поиска работы. Проект использует современный стек технологий и паттерны
проектирования для обеспечения надежности и эффективности.

### Основные компоненты

#### 1. **Главная функция `scrape_jobs()`**

- Центральная точка входа в библиотеку
- Использует `ThreadPoolExecutor` для конкурентного выполнения
- Агрегирует результаты в pandas DataFrame
- Обрабатывает различные форматы данных и нормализует их

#### 2. **Модель данных (model.py)**

- **JobPost**: Pydantic модель вакансии с полями для всех платформ
- **ScraperInput**: входные параметры поиска
- **JobResponse**: ответ скрапинга
- **Scraper**: абстрактный базовый класс для всех скрапперов
- **Country**: enum с поддержкой 70+ стран
- **JobType**: enum типов работы (fulltime, parttime, contract, internship,
  etc.)

#### 3. **Система скрапперов**

Каждый сайт имеет собственный скраппер, наследующий от базового `Scraper`:

- `Indeed` - наиболее надежный, использует официальный API
- `LinkedIn` - самый сложный для обхода защиты
- `Glassdoor` - использует GraphQL API
- `Google` - скрапинг Google Jobs
- `ZipRecruiter` - поиск в США и Канаде
- `Bayt` - международный поиск
- `Naukri` - индийский сайт вакансий
- `BDJobs` - бангладешский сайт вакансий

#### 4. **Утилиты (util.py)**

- **RotatingProxySession**: ротация прокси для обхода блокировок
- **TLSRotating**: TLS сессии с имитацией браузера
- **create_session()**: фабрика сессий с различными настройками
- Функции парсинга зарплат, email, типов работы

## Поддерживаемые методы поиска

### Платформы и их возможности

#### **Indeed** ⭐⭐⭐⭐⭐

- **Надежность**: Высокая (нет rate limiting)
- **Методы поиска**:
  - Ключевые слова (search_term)
  - Локация (location)
  - Радиус поиска (distance)
  - Тип работы (job_type)
  - Удаленная работа (is_remote)
  - Easy Apply фильтр
  - Возраст вакансий (hours_old)
- **API**: GraphQL API с официальным ключом
- **Особенности**: Поддерживает все страны, самые свежие результаты

#### **LinkedIn** ⭐⭐

- **Надежность**: Низкая (сильное rate limiting)
- **Методы поиска**:
  - Ключевые слова
  - Локация
  - Тип работы
  - Удаленная работа
  - Easy Apply
  - Возраст вакансий
  - ID компаний (linkedin_company_ids)
- **Метод**: HTML парсинг с имитацией браузера
- **Особенности**: Требует прокси, лимит ~10 страниц

#### **Glassdoor** ⭐⭐⭐⭐

- **Надежность**: Средняя
- **Методы поиска**:
  - Ключевые слова
  - Локация
  - Тип работы
  - Easy Apply
  - Возраст вакансий
- **API**: GraphQL API
- **Особенности**: CSRF токены, поддержка стран через домены

#### **Google Jobs** ⭐⭐⭐

- **Надежность**: Высокая
- **Методы поиска**:
  - Специфический поисковый запрос (google_search_term)
  - Временные фильтры
  - Тип работы
  - Удаленная работа
- **Метод**: Парсинг HTML с пагинацией
- **Особенности**: Требует точного синтаксиса запросов

#### **ZipRecruiter** ⭐⭐⭐

- **Надежность**: Средняя
- **Методы поиска**:
  - Ключевые слова
  - Локация (США/Канада)
  - Тип работы
  - Удаленная работа
- **Метод**: API запросы
- **Особенности**: Только США и Канада

#### **Bayt** ⭐⭐

- **Надежность**: Средняя
- **Методы поиска**:
  - Только ключевые слова
- **Метод**: HTML парсинг
- **Особенности**: Международный поиск

#### **Naukri** ⭐⭐⭐

- **Надежность**: Средняя
- **Методы поиска**:
  - Ключевые слова
  - Локация
- **API**: REST API
- **Особенности**: Специфические поля (навыки, опыт, рейтинг компании)

#### **BDJobs** ⭐⭐

- **Надежность**: Средняя
- **Методы поиска**:
  - Ключевые слова
- **Метод**: HTML парсинг
- **Особенности**: Бангладеш

## Методы обхода защиты

### Основные техники

#### 1. **Прокси ротация**

```python
class RotatingProxySession:
    - Циклическая смена прокси из списка
    - Форматирование прокси строк в словарь
    - Поддержка HTTP/SOCKS5 прокси
```

#### 2. **TLS имитация браузера**

```python
class TLSRotating:
    - Использует tls-client для имитации браузерных TLS fingerprints
    - random_tls_extension_order=True
    - Совместно с прокси ротацией
```

#### 3. **Retry логика**

```python
Retry(
    total=3,
    connect=3,
    status=3,
    status_forcelist=[500, 502, 503, 504, 429],
    backoff_factor=delay
)
```

#### 4. **Имитация User-Agent**

- Indeed: iPhone Safari
- LinkedIn: Chrome Desktop
- Glassdoor: Chrome с полными заголовками
- Google: Стандартные заголовки

### Платформо-специфические методы

#### **Indeed**

- **Защита**: Минимальная
- **Методы обхода**:
  - Официальный API ключ
  - User-Agent мобильного браузера
  - GraphQL запросы вместо HTML парсинга
- **Эффективность**: ⭐⭐⭐⭐⭐

#### **LinkedIn**

- **Защита**: Строгая (Cloudflare, rate limiting)
- **Методы обхода**:
  - Прокси обязательны
  - TLS имитация браузера
  - Случайные задержки (3-7 сек)
  - Очистка cookies между запросами
  - Ограничение до 1000 результатов
- **Эффективность**: ⭐⭐ (часто блокируется)

#### **Glassdoor**

- **Защита**: CSRF токены, rate limiting
- **Методы обхода**:
  - Динамическое получение CSRF токенов
  - Полные HTTP заголовки браузера
  - GraphQL запросы
  - Retry логика
- **Эффективность**: ⭐⭐⭐⭐

#### **Google**

- **Защита**: CAPTCHA, rate limiting
- **Методы обхода**:
  - Имитация естественного поиска
  - Пагинация через курсоры
  - Стандартные заголовки
- **Эффективность**: ⭐⭐⭐⭐

### Обработка ошибок

#### **HTTP коды**

- **429**: Слишком много запросов → смена прокси + задержка
- **403**: Заблокирован → смена прокси
- **500+**: Серверные ошибки → retry с backoff

#### **Специфические исключения**

- `LinkedInException`: Ошибки LinkedIn скрапинга
- `GlassdoorException`: Ошибки Glassdoor API
- `IndeedException`: Ошибки Indeed API
- И другие для каждой платформы

### Оптимизации производительности

#### **Конкурентное выполнение**

- `ThreadPoolExecutor` для параллельного скрапинга
- Отдельные потоки для каждого сайта
- Максимум 10 воркеров для детального парсинга

#### **Кеширование**

- `seen_urls` множество для избежания дубликатов
- Проверка существующих job_id

#### **Пагинация**

- Курсоры для эффективной навигации
- Адаптивные размеры страниц (25-100 вакансий)

## Зависимости и требования

### Основные библиотеки

- **requests**: HTTP клиент
- **tls-client**: TLS имитация браузера
- **beautifulsoup4**: HTML парсинг
- **pandas**: Обработка данных
- **pydantic**: Валидация данных
- **markdownify**: Конвертация HTML в Markdown
- **regex**: Продвинутые регулярные выражения

### Системные требования

- Python >= 3.10
- Поддержка TLS 1.3
- Стабильное интернет соединение
- Рекомендуется: прокси-серверы

## Ограничения и рекомендации

### Ограничения платформ

- **LinkedIn**: ~1000 результатов, требует прокси
- **Indeed**: Нет ограничений, но комбинации фильтров ограничены
- **Glassdoor**: ~900 результатов
- **Google**: Требует специфического синтаксиса запросов
- **ZipRecruiter**: Только США/Канада

### Лучшие практики

1. **Использовать прокси** для всех платформ кроме Indeed
2. **Добавлять задержки** между запросами
3. **Мониторить rate limits** и коды ответов
4. **Начинать с Indeed** как наиболее надежной платформы
5. **Тестировать запросы** перед массовым скрапингом

### Производительность

- Indeed: 100+ вакансий/минуту
- LinkedIn: 10-20 вакансий/минуту (с прокси)
- Glassdoor: 50-70 вакансий/минуту
- Google: 30-50 вакансий/минуту

## Заключение

JobSpy представляет собой хорошо спроектированную систему для скрапинга вакансий
с множеством техник обхода защиты. Архитектура основана на принципах SOLID, с
четким разделением ответственности между компонентами. Наиболее эффективен для
Indeed и Google, в то время как LinkedIn требует наиболее сложных мер обхода
защиты.

Библиотека активно развивается и поддерживает современные API и техники
веб-скрапинга, что делает ее надежным инструментом для автоматизированного
поиска вакансий.
